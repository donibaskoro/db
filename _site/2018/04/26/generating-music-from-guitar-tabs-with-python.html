<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Generating MIDI files from guitar tablatures with Python and regular expressions</title>
  <meta name="description" content="Recently I have been playing lots of classical guitar. I use classtab.org, a website with hundreds of classical guitar pieces in tab form. Here’s an example ...">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/2018/04/26/generating-music-from-guitar-tabs-with-python.html">
  <link rel="alternate" type="application/rss+xml" title="Brian Caffey" href="/feed.xml">
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75060954-1', 'auto');
  ga('send', 'pageview');

</script>
  <body>
    <style>
    img{
      display:block;
      margin:auto;
    }
    </style>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Brian Caffey</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/contact">Contact</a>
          
        
          
          <a class="page-link" href="/blog">Blog</a>
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/projects/index.html">Projects</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Generating MIDI files from guitar tablatures with Python and regular expressions</h1>
    <p class="post-meta"><time datetime="2018-04-26T00:00:00-05:00" itemprop="datePublished">Apr 26, 2018</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Recently I have been playing lots of classical guitar. I use <a href="classtab.org">classtab.org</a>, a website with hundreds of classical guitar pieces in tab form. Here’s an example of a guitar tab:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|---------------0---|---3-2-3-----------|-----0-------------|
|-------0-3-1-1---3-|-3-------3-0-----0-|-1-3---3-1-0---0---|
|---0-2-0-----------|-------------0-2---|-------------2---0-|
|-------------2-----|-------2-----------|-------------------|
|-------------------|-2-----------------|-0-----2-----3-----|
|-3-----------------|-------------0-----|-------------------|
</code></pre></div></div>

<p>It is a representation of where and when strings are played. The six lines here represent the six strings of the guitar e, A, D, G, B and E and the numbers indicate where on the fretboard to press for each note. The vertical bars represent one bar of music.</p>

<p>My goal is to write an application that can read in guitar tabs and then produce a corresponding MIDI file for the song.</p>

<p>To start, I will use regular expressions to parse the bars of music in a guitar tab text file.</p>

<p>Next, I will use a Python package called MIDIUtil to generate <code class="highlighter-rouge">.mid</code> files from the guitar tabs.</p>

<p>Finally, I’ll put this into a simple web app that lets users copy paste guitar tab text or enter a URL from a site like classtab.org that will similarly generate a MIDI file.</p>

<h2 id="regex">Regex</h2>

<p>First, let’s look at a few different examples of guitar tabs to get a better sense of what our goal should be in using regular expressions to parse notes.</p>

<h3 id="tab-examples">Tab examples</h3>

<p><a href="http://www.classtab.org/barrios_la_catedral_3_allegro.txt">http://www.classtab.org/barrios_la_catedral_3_allegro.txt</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>La Catedral
Author: Agustin Barrios
Tablature by: Gianpiero Ciammaricone
              giancian@yahoo.com
              http://www.geocities.com/vienna/6619

Tablature Explanation at the end.

[key corrected from "D Major" Jan 99]

This is Revision 3 (5/2/98), I have added a modification made by
Barrios in line 5 of the TAB, both ways of playing it are included,
so you can choose the best one for you.
Revision 2: Made a few corrections.
Revision 1: The first release of the tab.

3rd Movement (Allegro):
Key: B Minor
Time signature: 6/8

E-|-------------------------|-----------------------------|
B-|-----------------3-------|-----------------3-----------|
G-|---------0---4-------4---|---------0---4-------4-------|
D-|---4-3h4---4---4---4---4-|---4-3h4---4---4---4---4-----|
A-|-2-----------------------|-2---------------------------|
E-|-------------------------|-----------------------------|
    p m i   m i m i a i m i

E-|-------------------------|-----------------------------|
B-|-----------------3-------|-----------------3-----------|
G-|---------2---4-------4---|---------2---4-------4-------|
D-|---5-4h5---5---5---5---5-|---5-4h5---5---5---5---5-----|
A-|-2-----------------------|-2---------------------------|
E-|-------------------------|-----------------------------|
    p m i   m i m i a i m i

E-|-------------------------|-----------------------------|
B-|-----------------5-------|-----------------5-----------|
G-|---------4---6-------6---|---------4---6-------6-------|
D-|---7-6h7---7---7---7---7-|---7-6h7---7---7---7---7-----|
A-|-4-----------------------|-4---------------------------|
E-|-------------------------|-----------------------------|
    p m i   m i m i a i m i  
</code></pre></div></div>

<p><a href="http://www.classtab.org/moreno_torroba_siete_piezas_de_album_6_chisperada.txt">http://www.classtab.org/moreno_torroba_siete_piezas_de_album_6_chisperada.txt</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SIETE PIEZAS DE ALBUM: VI. CHISPERADA
As recorded by Federico Moreno Torroba

Music by Federico Moreno Torroba

|-----0-----0-|-----------0-|-----0-----0-|
|---1-----0---|-----3-----0-|---1-----0---|
|---2-----0---|---2-------1-|---2-----0---|
|---2---------|---3---------|---2---------|
|-0-----------|---------2---|-0-----------|
|-------3-----|-1-----0-----|-------3-----|

|-----------0-|-----0-----0-|-----------0-|-----------0--|
|-----3-----0-|---1-----0---|-----3-----0-|-----3-----0--|
|---2-------1-|---2-----0---|---2-------1-|---2-------1--|
|---3---------|---2---------|---3---------|---3----------|
|---------2---|-0-----------|-0-------2---|-0-------2----|
|-1-----0-----|-------3-----|-------0-----|-------0------|

|---------------0--|-0-----0-----|-1-----1-3p1-0---|
|---1-0---------0--|-1-----------|---------------3-|
|-2-----2-0-----1--|-2-----1-----|-2-----2---------|
|-----------3------|-------------|-------0---------|
|-3----------------|---0-0---2-2-|---3-3-----------|
|-------------0----|-------------|-----------------|
</code></pre></div></div>

<p><a href="http://www.classtab.org/moreno_torroba_sonatina_in_a_2_andante.txt">http://www.classtab.org/moreno_torroba_sonatina_in_a_2_andante.txt</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sonatina in A - II - Andante

F. Moreno Torroba (1891-1982)

tuning DADGBE

E|-----2--3---5----------10--8--7-------|-----8----7^8^7-----------------------|
B|-----3--5---7----------7--------------|-----8-----------10---------8---------|
G|-----2---------------------9--7-------|-----9--------------------------11----|
D|-----0--------------4-----------------|--------------------------10----------|
A|-----0----------0---------------------|----------------------7---------------|
D|-----0--------------------------------|-----0--------------------------------|

E|--------------------------------------|--------------------------------------|
B|------------------7--8^10-8---7^5-----|---5---------7-8-7-5-----5------------|
G|--9^11^9----7--9------------------7---|---6-----------------7---6------------|
D|-------8------------------------------|---5---------------------5--7----19°--|
A|-------10-----------------------------|------0--12°--------------------------|
D|-------0------------------------------|---0---------------------0------------|
</code></pre></div></div>

<p>Here are a few things that we need to consider:</p>

<ul>
  <li>
    <p>The start of each line sometimes starts with a the note of the string (<code class="highlighter-rouge">E</code> or <code class="highlighter-rouge">e</code>, <code class="highlighter-rouge">A</code>, <code class="highlighter-rouge">D</code>, etc.) followed by <code class="highlighter-rouge">|</code> or just simply start with <code class="highlighter-rouge">|</code>. Some lines may start with <code class="highlighter-rouge">E-|</code>.</p>
  </li>
  <li>
    <p>There is generally a <code class="highlighter-rouge">-</code> character between each note. When this is not the case, we may have a <code class="highlighter-rouge">p</code>, <code class="highlighter-rouge">h</code> or <code class="highlighter-rouge">^</code> which indicates “pull off” or “hammer on”. This means that you are playing the string with the hand on the fretboard, not the hand over the sound hole. We should replace these with <code class="highlighter-rouge">-</code>.</p>
  </li>
  <li>
    <p>A tab may have an inconsistant number of characters in each bar. I’m not too concerned about this. I’m not going for perfection just yet, but it could make this task very difficult if you want to get the timing of your sounds just right.</p>
  </li>
  <li>
    <p>Notes played on the 10th fret and higher must be read together. For example, <code class="highlighter-rouge">---12---</code> should be played on the 12 fret; it does not mean play <code class="highlighter-rouge">1</code> and then play <code class="highlighter-rouge">2</code>.</p>
  </li>
  <li>
    <p>There are some other special characters such as <code class="highlighter-rouge">°</code> or <code class="highlighter-rouge">&lt;</code>/<code class="highlighter-rouge">&gt;</code>. I think these both denote harmonics. This is when you place your finger on the string at a position along the fretboard, but do not press down. We probably want to replace these characters with <code class="highlighter-rouge">-</code> as well.</p>
  </li>
</ul>

<h3 id="tab-text-file-processing">Tab text file processing</h3>

<p>Here are some things that may be helpful to do as soon as we read a text file:</p>

<ul>
  <li>
    <p>convert everything to upper or lower case</p>
  </li>
  <li>
    <p>replace non-numeric characters with <code class="highlighter-rouge">-</code></p>
  </li>
</ul>

<p>When I work with regex, I usually go straight to <a href="regex101.com">regex101.com</a>.</p>

<h2 id="midiutil">MIDIUtil</h2>

<p>At this point, I think it will be helpful to examine MIDIUtil and create and play a basic MIDI file.</p>

<p>Before you do that, you might want to read over the <a href="https://wiki.archlinux.org/index.php/MIDI">MIDI Arch Wiki article</a>.</p>

<blockquote>
  <p>MIDIUtil is a pure Python library that allows one to write multi-track Musical Instrument Digital Interface (MIDI) files from within Python programs (both format 1 and format 2 files are now supported). It is object-oriented and allows one to create and write these files with a minimum of fuss.</p>
</blockquote>

<p>Here’s a basic example of MIDIUtil. This script generates a MIDI file that contains a major scale.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">midiutil</span> <span class="kn">import</span> <span class="n">MIDIFile</span>

<span class="n">degrees</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">72</span><span class="p">]</span>  <span class="c"># MIDI note number</span>
<span class="n">track</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">channel</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span>    <span class="c"># In beats</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c"># In beats</span>
<span class="n">tempo</span>    <span class="o">=</span> <span class="mi">60</span>   <span class="c"># In BPM</span>
<span class="n">volume</span>   <span class="o">=</span> <span class="mi">100</span>  <span class="c"># 0-127, as per the MIDI standard</span>

<span class="n">MyMIDI</span> <span class="o">=</span> <span class="n">MIDIFile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># One track, defaults to format 1 (tempo track is created</span>
                      <span class="c"># automatically)</span>
<span class="n">MyMIDI</span><span class="o">.</span><span class="n">addTempo</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tempo</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="n">MyMIDI</span><span class="o">.</span><span class="n">addNote</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"major-scale.mid"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">MyMIDI</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</code></pre></div></div>

<p>Now let’s try to play this file. Well, if you read the MIDI article, you would know that this isn’t really what we are doing. We want to see what our major scale sounds like. In order to do that, we need to install and configure both a MIDI synthesizer as well as a soundfont.</p>

<p>We can use timidity++ for our MIDI synth. There are very simple instructions on how to do this <a href="https://wiki.archlinux.org/index.php/timidity">here</a>.</p>

<p>Here are the steps I followed:</p>

<p>From the AUR, install <code class="highlighter-rouge">timidity++</code> and <code class="highlighter-rouge">timidity-freepats</code>.</p>

<p>Add yourself to the audio group:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gpasswd -a brian audio
</code></pre></div></div>

<p>Add the following line to <code class="highlighter-rouge">/etc/timidity++/timidity.cfg</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>soundfont /usr/share/soundfonts/timidity-freepats.sf2
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl start timidity.service
sudo systemctl enable timidity.service
</code></pre></div></div>

<p>Run <code class="highlighter-rouge">aplaymidi -l</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ aplaymidi -l
 Port    Client name                      Port name
 14:0    Midi Through                     Midi Through Port-0
130:0    TiMidity                         TiMidity port 0
130:1    TiMidity                         TiMidity port 1
130:2    TiMidity                         TiMidity port 2
130:3    TiMidity                         TiMidity port 3
</code></pre></div></div>

<p>Finally, we can play our MIDI file that we generated by running the python script above:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ aplaymidi major-scale.mid --port 130:0
&lt;music plays...&gt;
</code></pre></div></div>

<p>For this project, playing files using a synthesizer is useful to verify that the MIDI was successfully created. If/when we get to the point of making a web app to convert midi files to music files, we will generate the midifile in-memory, convert it to a WAV file and then return that to the user.</p>

<p>Let’s try to process a very simple tab file with just one string and a few notes, and then generate a simple MIDI file based on the tab.</p>

<p>Our sample tab can be:</p>

<p><em>simple-tab.txt</em></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--0--2--4--
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">midiutil</span> <span class="kn">import</span> <span class="n">MIDIFile</span>

<span class="n">degrees</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">72</span><span class="p">]</span>  <span class="c"># MIDI note number</span>
<span class="n">track</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">channel</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span>    <span class="c"># In beats</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c"># In beats</span>
<span class="n">tempo</span>    <span class="o">=</span> <span class="mi">60</span>   <span class="c"># In BPM</span>
<span class="n">volume</span>   <span class="o">=</span> <span class="mi">100</span>  <span class="c"># 0-127, as per the MIDI standard</span>

<span class="n">MyMIDI</span> <span class="o">=</span> <span class="n">MIDIFile</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># One track, defaults to format 1 (tempo track is created</span>
                      <span class="c"># automatically)</span>
<span class="n">MyMIDI</span><span class="o">.</span><span class="n">addTempo</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tempo</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="n">MyMIDI</span><span class="o">.</span><span class="n">addNote</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"major-scale.mid"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">MyMIDI</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ echo "--0--2--4--" &gt; simple-tab.txt
</code></pre></div></div>

<p>Here’s the script I used to generate some fairly accurate MIDI files. There are still some bugs in the script that generates the MIDI file, but this meets the goal I had last weekend of writing a simple script to generate music from guitar tabs.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">midiutil</span> <span class="kn">import</span> <span class="n">MIDIFile</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">string_notes</span> <span class="o">=</span> <span class="p">[</span><span class="s">"high_e"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">,</span> <span class="s">"G"</span><span class="p">,</span> <span class="s">"D"</span><span class="p">,</span> <span class="s">"A"</span><span class="p">,</span> <span class="s">"E"</span><span class="p">]</span>

<span class="n">guitar_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'E'</span><span class="p">:{</span><span class="s">'note_val'</span><span class="p">:</span><span class="mi">52</span><span class="p">,</span> <span class="s">'track_num'</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>
    <span class="s">'A'</span><span class="p">:{</span><span class="s">'note_val'</span><span class="p">:</span><span class="mi">57</span><span class="p">,</span> <span class="s">'track_num'</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
    <span class="s">'D'</span><span class="p">:{</span><span class="s">'note_val'</span><span class="p">:</span><span class="mi">62</span><span class="p">,</span> <span class="s">'track_num'</span><span class="p">:</span><span class="mi">2</span><span class="p">},</span>
    <span class="s">'G'</span><span class="p">:{</span><span class="s">'note_val'</span><span class="p">:</span><span class="mi">67</span><span class="p">,</span> <span class="s">'track_num'</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span>
    <span class="s">'B'</span><span class="p">:{</span><span class="s">'note_val'</span><span class="p">:</span><span class="mi">71</span><span class="p">,</span> <span class="s">'track_num'</span><span class="p">:</span><span class="mi">4</span><span class="p">},</span>
    <span class="s">'high_e'</span><span class="p">:{</span><span class="s">'note_val'</span><span class="p">:</span><span class="mi">76</span><span class="p">,</span> <span class="s">'track_num'</span><span class="p">:</span><span class="mi">5</span><span class="p">},</span>
<span class="p">}</span>

<span class="c"># read the tab file</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'txt'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Please select a text file"</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"h"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
<span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"p"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
<span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
<span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"*"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
<span class="n">contents</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">bar_group</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r"(?:[E,B,G,D,A,-]+\|[0-9-h|]+\n){6}"</span><span class="p">,</span><span class="n">contents</span><span class="p">)</span>

<span class="c">#bar_group = re.findall(r"(?:\|[0-9-\*h\|]+\n){6}",contents)</span>


<span class="n">track</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">channel</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="n">time</span>     <span class="o">=</span> <span class="mi">0</span>    <span class="c"># In beats</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c"># In beats</span>
<span class="n">tempo</span>    <span class="o">=</span> <span class="mi">1000</span>   <span class="c"># In BPM</span>
<span class="n">volume</span>   <span class="o">=</span> <span class="mi">100</span>  <span class="c"># 0-127, as per the MIDI standard</span>

<span class="n">MyMIDI</span> <span class="o">=</span> <span class="n">MIDIFile</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c"># One track, defaults to format 1 (tempo track is created</span>
                      <span class="c"># automatically)</span>
<span class="n">MyMIDI</span><span class="o">.</span><span class="n">addTempo</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tempo</span><span class="p">)</span>

<span class="n">interval</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bar_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bar_group</span><span class="p">:</span>

    <span class="n">strings</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">strings</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s">''</span><span class="p">]</span>
    <span class="n">e_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
        
        <span class="n">current_string</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">current_string</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">guitar_strings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">current_string</span> <span class="o">=</span> <span class="n">string_notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">current_string</span> <span class="o">==</span> <span class="s">"E"</span><span class="p">:</span>
            <span class="n">e_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">e_count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">current_string</span> <span class="o">==</span> <span class="s">"high_e"</span>

        <span class="n">track</span> <span class="o">=</span> <span class="n">guitar_strings</span><span class="p">[</span><span class="n">current_string</span><span class="p">][</span><span class="s">'track_num'</span><span class="p">]</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'|'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="mi">100</span>
            
            <span class="k">if</span> <span class="n">pitch</span> <span class="o">==</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">pitch</span> <span class="o">==</span> <span class="s">"-"</span><span class="p">:</span>
                <span class="n">volume</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pitch</span> <span class="o">=</span> <span class="mi">50</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"adding note"</span><span class="p">)</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span> <span class="o">+</span> <span class="n">guitar_strings</span><span class="p">[</span><span class="n">current_string</span><span class="p">][</span><span class="s">'note_val'</span><span class="p">]</span>
            <span class="n">MyMIDI</span><span class="o">.</span><span class="n">addNote</span><span class="p">(</span><span class="n">track</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">time</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>
        
    <span class="n">time</span> <span class="o">+=</span> <span class="n">interval</span><span class="o">*</span><span class="mi">8</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"major-scale.mid"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">MyMIDI</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</code></pre></div></div>

<p>Here’s me playing one of my favorite songs, you might recognize it!</p>

<blockquote class="instagram-media" data-instgrm-captioned="" data-instgrm-permalink="https://www.instagram.com/p/rg2gmyyFdC/" data-instgrm-version="8" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:8px;"> <div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:50% 0; text-align:center; width:100%;"> <div style=" background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;"></div></div> <p style=" margin:8px 0 0 0; padding:0 4px;"> <a href="https://www.instagram.com/p/rg2gmyyFdC/" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank">Written in 1902, this catchy tune from Fransico Tárrega&#39;s &#39;Gran Vals&#39; is now heard by an estimated 22,000 per second worldwide.. it is also a registered sound trademark of a billion dollar Finnish company 🎵 #franciscotárrega #tarrega #tárrega #classicalguitar #spanishguitarist #spain #instamusic #granvals #grandevalse #grandwaltz #crownmolding</a></p> <p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">A post shared by <a href="https://www.instagram.com/briancaffey/" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px;" target="_blank"> Brian</a> (@briancaffey) on <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2014-08-10T09:48:59+00:00">Aug 10, 2014 at 2:48am PDT</time></p></div></blockquote>
<script async="" defer="" src="//www.instagram.com/embed.js"></script>


  </div>

<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'briancaffey'; // required: replace example with your forum shortname
  var disqus_identifier = "/2018/04/26/generating-music-from-guitar-tabs-with-python.html";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Brian Caffey</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Brian Caffey</li>
          <li><a href="mailto:briancaffey2010@gmail.com">briancaffey2010@gmail.com</a></li>
          <li><a href="https://briancaffey.github.io">briancaffey.github.io</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/briancaffey">
    <span class="purple-icon icon--github">
        <svg viewBox="0 0 16 16">
    <path fill="#6e5494" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>
    </span>
    <span class="username">
        briancaffey
    </span>
</a>
          </li>
          
          
          <li>
            <a href="https://gitlab.com/briancaffey">
    <span class="gitlab-fox">
        
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="210px" height="194px" viewBox="0 0 210 194" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <!-- Generator: Sketch 3.3.2 (12043) - http://www.bohemiancoding.com/sketch -->
    <title>Group</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
        <g id="Fill-1-+-Group-24" sketch:type="MSLayerGroup">
            <g id="Group-24" sketch:type="MSShapeGroup">
                <g id="Group">
                    <path d="M105.0614,193.655 L105.0614,193.655 L143.7014,74.734 L66.4214,74.734 L105.0614,193.655 L105.0614,193.655 Z" id="Fill-4" fill="#E24329"></path>
                    <path id="Fill-6" fill="#FC6D26"></path>
                    <path d="M105.0614,193.6548 L66.4214,74.7338 L12.2684,74.7338 L105.0614,193.6548 Z" id="Fill-8" fill="#FC6D26"></path>
                    <path id="Fill-10" fill="#FC6D26"></path>
                    <path d="M12.2685,74.7341 L12.2685,74.7341 L0.5265,110.8731 C-0.5445,114.1691 0.6285,117.7801 3.4325,119.8171 L105.0615,193.6551 L12.2685,74.7341 Z" id="Fill-12" fill="#FCA326"></path>
                    <path id="Fill-14" fill="#FC6D26"></path>
                    <path d="M12.2685,74.7342 L66.4215,74.7342 L43.1485,3.1092 C41.9515,-0.5768 36.7375,-0.5758 35.5405,3.1092 L12.2685,74.7342 Z" id="Fill-16" fill="#E24329"></path>
                    <path d="M105.0614,193.6548 L143.7014,74.7338 L197.8544,74.7338 L105.0614,193.6548 Z" id="Fill-18" fill="#FC6D26"></path>
                    <path d="M197.8544,74.7341 L197.8544,74.7341 L209.5964,110.8731 C210.6674,114.1691 209.4944,117.7801 206.6904,119.8171 L105.0614,193.6551 L197.8544,74.7341 Z" id="Fill-20" fill="#FCA326"></path>
                    <path d="M197.8544,74.7342 L143.7014,74.7342 L166.9744,3.1092 C168.1714,-0.5768 173.3854,-0.5758 174.5824,3.1092 L197.8544,74.7342 Z" id="Fill-22" fill="#E24329"></path>
                </g>
            </g>
        </g>
    </g>
</svg>
    </span>
    <span class="username">
        briancaffey
    </span>
</a>
          </li>
          
          
          <li>
            <a href="https://twitter.com/briancaffey"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#00aced" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">briancaffey</span></a>

          </li>
          
          
          <li>
                <a href="https://www.linkedin.com/in/brian-caffey-06b22a18">
      <span class="icon  icon--linkedin">
        <svg viewBox="0 50 512 512" >
          <path fill="#828282" d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
          C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
          M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
          c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
          s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"/>
        </svg>
      </span>
  
      <span class="username">Brian Caffey</span>
    </a>
          </li>
          
          
          <li>
            <a href="https://stackoverflow.com/users/6084948/briancaffey">
    <span class="so-icon icon--github">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 120 120" style="enable-background:new 0 0 120 120;" xml:space="preserve">
<style type="text/css">
	.st0{fill:#BCBBBB;}
	.st1{fill:#F48023;}
</style>
<polygon class="st0" points="84.4,93.8 84.4,70.6 92.1,70.6 92.1,101.5 22.6,101.5 22.6,70.6 30.3,70.6 30.3,93.8 "/>
<path class="st1" d="M38.8,68.4l37.8,7.9l1.6-7.6l-37.8-7.9L38.8,68.4z M43.8,50.4l35,16.3l3.2-7l-35-16.4L43.8,50.4z M53.5,33.2
	l29.7,24.7l4.9-5.9L58.4,27.3L53.5,33.2z M72.7,14.9l-6.2,4.6l23,31l6.2-4.6L72.7,14.9z M38,86h38.6v-7.7H38V86z"/>
</svg>

    </span>
    <span class="username">
        briancaffey
    </span>
</a>
          </li>
          
        </ul>
      </div>
      
      <div class="footer-col footer-col-3">
        <p>my personal site</p>
      </div>
      
    </div>

  </div>

</footer>


  </body>

</html>
