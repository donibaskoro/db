<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Detailed setup of a mini Django News App project with Bootstrap, AJAX, Celery and RabbitMQ</title>
  <meta name="description" content="The Django project started in the news room. This article will offer detailed documentation of the setup process for a simple news application. This project ...">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/2018/02/09/a-sample-django-news-app.html">
  <link rel="alternate" type="application/rss+xml" title="Brian Caffey" href="/feed.xml">
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75060954-1', 'auto');
  ga('send', 'pageview');

</script>
  <body>
    <style>
    img{
      display:block;
      margin:auto;
    }
    </style>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Brian Caffey</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/contact">Contact</a>
          
        
          
          <a class="page-link" href="/blog">Blog</a>
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/projects/index.html">Projects</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Detailed setup of a mini Django News App project with Bootstrap, AJAX, Celery and RabbitMQ</h1>
    <p class="post-meta"><time datetime="2018-02-09T00:00:00-06:00" itemprop="datePublished">Feb 9, 2018</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>The Django project started in the news room. This article will offer detailed documentation of the setup process for a simple news application. This project was given as a takehome assignment for another Django position I am interview for. I won’t focus on any production considerations as this is only a demo project that is supposed to work locally.</p>

<p>For reference, the code is on <a href="https://github.com/briancaffey/django-news-app">this Github repository</a>.</p>

<h2 id="requirements">Requirements</h2>

<p>This project included some interesting requirements that were outside of the scope of simple apps I have put together with Django. Two import ones were page caching and using celery to execute tasks asynchronously. I also set up a unit tests and functional tests and tested the core functionalities of the application. Here are some the basic requirements:</p>

<ul>
  <li>Implement a news model with fields such as title, body, content, author, etc.</li>
  <li>Display published posts on a page styled with Bootstrap</li>
  <li>Implement and admin page that allows staff to create and publish posts</li>
  <li>Cache the public facing home page</li>
  <li>On the home page use jQuery to poll a URL for updates, and refresh the page if an update is found.</li>
  <li>Add a button on the public facing page that when pressed launches a celery task that send an email to the site admin.</li>
</ul>

<h2 id="release-notes-and-code-snippets">Release Notes and code snippets</h2>

<p>Here’s a quick description of the design decisions I made for the various specifications with code snippets:</p>

<h4 id="post-model">Post Model</h4>

<p>For the Post model I decided to use two DateTimeFields: <code class="highlighter-rouge">updated</code> and <code class="highlighter-rouge">timestamp</code>. <code class="highlighter-rouge">timestamp</code> is the public-facing time that shows on each article. <code class="highlighter-rouge">updated</code> is changed when a publish or unpublish action is taken on a Post.</p>

<p>When a <code class="highlighter-rouge">POST</code> request is made to the <code class="highlighter-rouge">toggle_publish</code> view, three things happen:</p>

<ul>
  <li>
    <p>The Post’s <code class="highlighter-rouge">published</code> field is toggled and the Post’s <code class="highlighter-rouge">updated</code> field is set to the current time.</p>
  </li>
  <li>
    <p>The only record in <code class="highlighter-rouge">LastUpdate</code> is updated. This model only contains a <code class="highlighter-rouge">DateTimeField</code> also called <code class="highlighter-rouge">updated</code>.</p>
  </li>
  <li>
    <p>The cache is cleared, clearing any pages cached from the <code class="highlighter-rouge">home</code> view.</p>
  </li>
</ul>

<h4 id="home-page">Home Page</h4>

<p>For the public facing home page, I return a list of Posts where <code class="highlighter-rouge">published</code> is set to <code class="highlighter-rouge">True</code> and also return a UNIX time epoch of the Post with the most recent <code class="highlighter-rouge">updated</code> field.</p>

<p><em>views.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@cache_page</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">"""
    This is the public view that displays only published posts. 
    The view also returns a UNIX timestamp of the most recently updated post.
    This timestamp is compared with the `LastUpdate` value to determine when the page should be refreshed.
    Every 5 seconds, the `latest` timestamp is compared with the `LastUpdate` timestamp. 
    If `LastUpdate` is greater that `latest`, this implies that a Post has either been published or unpublished.
    """</span>

    <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">published</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">latest</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">posts</span><span class="p">:</span>
        <span class="n">latest</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">'updated'</span><span class="p">)</span><span class="o">.</span><span class="n">unix_time</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'posts/home.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'posts'</span><span class="p">:</span><span class="n">posts</span><span class="p">,</span> <span class="s">'latest'</span><span class="p">:</span><span class="n">latest</span><span class="p">})</span>
</code></pre></div></div>

<h4 id="ajax-poll-on-home-page">AJAX poll on home page</h4>

<p>I use an AJAX poll that returns a JSON response containing the <code class="highlighter-rouge">updated</code> field of <code class="highlighter-rouge">LastUpdate</code> as a UNIX time epoch called <code class="highlighter-rouge">latest</code>. I compare this UNIX time epoch with the the UNIX time epoch returned with context data in <code class="highlighter-rouge">home</code>. If the <code class="highlighter-rouge">latest</code> value is greater than the the UNIX time stamp of the most recently updated article, then the page is reloaded. At this point, the cache will have been cleared by <code class="highlighter-rouge">toggle_publish</code>, and the new Posts are displayed.</p>

<p><em>home.html</em> (AJAX poll)</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"working"</span><span class="p">)</span>
    <span class="nx">poll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'/refresh'</span><span class="p">,</span>
        <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'get'</span><span class="p">,</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">latest</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">latest</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">latest_local</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"#last"</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data'</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">latest</span> <span class="o">&gt;</span> <span class="nx">latest_local</span> <span class="o">+</span> <span class="mi">2</span><span class="p">){</span>
                <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'The refresh poll was not successful'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">pollInterval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">poll</span><span class="p">();</span>
        <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p><em>views.py</em> (the view that the AJAX poll requests; return JSON)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">"""
    This is the URL that is polled by the public-facing page.
    It returns a UNIX timestamp of the last time an article was published or unpublished. 
    This timestamp comes from the `LastUpdated`, a table that stores and updates only one row with one datetime column.
    Publishing and unpublishing are the only two actions that clear the cached homepage. 
    When the returned UNIX timestamp is greater than the UNIX timestamp of the most recently updated article,
    The page is refreshed with `location.reload()`.
    """</span>
    
    <span class="n">t</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">LastUpdate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">unix_time</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">unix_time</span><span class="p">()</span>
    <span class="n">latest</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s">'latest'</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">latest</span><span class="p">)})</span>
</code></pre></div></div>

<h4 id="email-admin-through-a-celery-task">Email admin through a celery task</h4>

<p>The email feature is functional, but the button returns a JSON response that says “successful” if the message was sent to celery. My plan was to make another AJAX call and then updated the <code class="highlighter-rouge">Email Admin</code> link to say <code class="highlighter-rouge">Your email was sent.</code> if it the task was sent the messaging service.</p>

<p>For details on how celery can be set up with a Django project, I reference on of my favorite Django blogs, <a href="https://simpleisbetterthancomplex.com/tutorial/2017/08/20/how-to-use-celery-with-django.html">simpleisbetterthancomplex.com</a>. This article shows how to set up celery in a Django project and my set up almost exactly mirrors this setup, but my celery task simply sends an email.</p>

<h4 id="admin-page">Admin Page</h4>

<p>The admin page contains a list of all articles. Each article contains a link to manage publish settings. This calls the <code class="highlighter-rouge">toggle_publish</code> page that displays the selected article and contains a button that says <code class="highlighter-rouge">Publish</code> or <code class="highlighter-rouge">Unpublish</code> depending on the value of the Post’s <code class="highlighter-rouge">published</code> value.</p>

<h4 id="cache">Cache</h4>

<p>For caching I chose the memcached backend. Other options included using file caching and database caching, but this seemed to be the simplest approach. I used a decorator function to cache the results of the <code class="highlighter-rouge">home</code> view.</p>

<p>Here are some additional notes on how I used caching in this project:</p>

<ul>
  <li>To cache a page from the <code class="highlighter-rouge">home</code> view, I used a decorator: <code class="highlighter-rouge">from django.views.decorators.cache import cache_page</code>:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@cache_page</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>
    <p>We pass the argument of <code class="highlighter-rouge">None</code> so that the page cache does not expire; we will manually clear the cache when a staff member publishes an article.</p>
  </li>
  <li>
    <p>The first time we access the <code class="highlighter-rouge">home</code> view, we will see our print statement, in subsequent requests, the cached page will be used and we will not see the print statement.</p>
  </li>
</ul>

<p>In order for caching to work we need to add the following to <code class="highlighter-rouge">settings.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'BACKEND'</span><span class="p">:</span> <span class="s">'django.core.cache.backends.memcached.MemcachedCache'</span><span class="p">,</span>
        <span class="s">'LOCATION'</span><span class="p">:</span> <span class="s">'127.0.0.1:11211'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next, we need to install the following packages:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(virtualenv) $ pip install memcache 
# pacman -S memcached
# systemctl start memcached
# systemctl enable memcached
</code></pre></div></div>

<h5 id="clearing-the-cache">Clearing the cache</h5>

<p>To clear the cache, we can simply do the following in a view:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">toggle_publish</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="nb">id</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s">"POST"</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">published</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">published</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">LastUpdate</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">updated</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">updated</span>
        <span class="n">t</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'posts:home'</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s">'post'</span><span class="p">:</span><span class="n">instance</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'posts/publish.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">cache.clear()</code> clears the cache, and the <code class="highlighter-rouge">home</code> view is regenerated from the Queryset and template rather the being served directly from the cache. This newly generated page is then saved to the cache and used on subsequent calls to <code class="highlighter-rouge">home</code> until the cache is cleared again.</p>

<h2 id="basic-setup">Basic setup</h2>

<p>Here are the first steps need to set up the project correctly:</p>

<p>First, let’s start with creating a virtual environment:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ virtualenv -p python3 virtualenv
</code></pre></div></div>

<p>Next, let’s activate the virtual environment with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ source virtualenv/bin/activate
</code></pre></div></div>

<p>Next, let’s install <code class="highlighter-rouge">django</code> and <code class="highlighter-rouge">selenium</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(virtualenv) $ pip install django selenium
</code></pre></div></div>

<p>Next, let’s start our app:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(virtualenv) $ django-admin.py startproject news .
</code></pre></div></div>

<p>The <code class="highlighter-rouge">.</code> will start the project in the current environment. Let’s take a look at the directory structure:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(virtualenv) $ tree -L 2
 $ tree -L 2
.
├── manage.py
├── news
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── virtualenv
    ├── bin
    ├── include
    ├── lib
    ├── pip-selfcheck.json
    └── selenium
</code></pre></div></div>

<p>At this point, we can start the local server:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(virtualenv) $ python manage.py runserver
Performing system checks...

System check identified no issues (0 silenced).

You have 14 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.
Run 'python manage.py migrate' to apply them.

February 10, 2018 - 02:16:47
Django version 2.0.2, using settings 'news.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre></div></div>

<p>Now we should see the new Django 2 startup screen in our browser if we navigate to <a href="">http://127.0.0.1:8000/</a>:</p>

<p><img src="/static/news/django2.png" alt="png" /></p>

<h2 id="testing">Testing</h2>

<p>I had a few difficulties setting up selenium testing with this projects. Here the <code class="highlighter-rouge">functional_tests.py</code> file that is hopefully configured correctly:</p>

<p><strong>functional_tests.py</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">'DJANGO_SETTINGS_MODULE'</span><span class="p">,</span> <span class="s">'news.settings'</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">LiveServerTestCase</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">factory</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">User</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">UserFactory</span><span class="p">(</span><span class="n">factory</span><span class="o">.</span><span class="n">DjangoModelFactory</span><span class="p">):</span>
    <span class="s">"""This class sets up a staff user that we can use for testing using factory"""</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>

    <span class="n">email</span> <span class="o">=</span> <span class="s">'brian@djangonews.com'</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s">'brian1'</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">PostGenerationMethodCall</span><span class="p">(</span><span class="s">'set_password'</span><span class="p">,</span> <span class="s">'qwer1234'</span><span class="p">)</span>

    <span class="n">is_superuser</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">is_staff</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">NewsAppTest</span><span class="p">(</span><span class="n">LiveServerTestCase</span><span class="p">):</span>
    <span class="s">"""Main Tests"""</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="s">'http://127.0.0.1:8081'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">UserFactory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">test_page_title_is_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Django News'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_staff_can_create_and_publish_article</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Tests the core functionality of a staff member loging in, creating an article, then publishing that article
        """</span>

        <span class="c"># staff logs into admin page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">+</span><span class="s">"/admin"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id_username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'brian1'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id_password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'qwer1234'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'submit-row'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="c"># navigate to homepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># navigate to new article page and write sample article</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'new-article'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'Write your Django News article here'</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id_title'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'testing with selenium'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id_content'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'about testing with selenium'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'id_submit'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'publish settings'</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

        <span class="c"># go back to home page and check that the article is not displayed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="s">'testing with selenium'</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'toggle-publish'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s">'testing with selenium'</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_public_page_reloads_when_article_is_published</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">browser2</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
        <span class="n">browser2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">browser2</span><span class="o">.</span><span class="n">page_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_staff_can_create_and_publish_article</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">browser2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">html_after_publish</span> <span class="o">=</span> <span class="n">browser2</span><span class="o">.</span><span class="n">page_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">html_after_publish</span><span class="p">)</span>
        <span class="n">browser2</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">warnings</span><span class="o">=</span><span class="s">"ignore"</span><span class="p">)</span>
</code></pre></div></div>

<p>I used the package called <code class="highlighter-rouge">factory_boy</code> to setup create a user that I could use in my test. This project didn’t include a staff registration page, so to test regular staff functionality I used <code class="highlighter-rouge">factory</code> to create a dummy user that can login and perform tasks.</p>

<p>For the full repo, please find it on my github account: <a href="https://github.com/briancaffey/django-news-app">https://github.com/briancaffey/django-news-app</a>.</p>

  </div>

<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'briancaffey'; // required: replace example with your forum shortname
  var disqus_identifier = "/2018/02/09/a-sample-django-news-app.html";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Brian Caffey</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Brian Caffey</li>
          <li><a href="mailto:briancaffey2010@gmail.com">briancaffey2010@gmail.com</a></li>
          <li><a href="https://briancaffey.github.io">briancaffey.github.io</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/briancaffey">
    <span class="purple-icon icon--github">
        <svg viewBox="0 0 16 16">
    <path fill="#6e5494" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
</svg>
    </span>
    <span class="username">
        briancaffey
    </span>
</a>
          </li>
          
          
          <li>
            <a href="https://gitlab.com/briancaffey">
    <span class="gitlab-fox">
        
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="210px" height="194px" viewBox="0 0 210 194" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <!-- Generator: Sketch 3.3.2 (12043) - http://www.bohemiancoding.com/sketch -->
    <title>Group</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
        <g id="Fill-1-+-Group-24" sketch:type="MSLayerGroup">
            <g id="Group-24" sketch:type="MSShapeGroup">
                <g id="Group">
                    <path d="M105.0614,193.655 L105.0614,193.655 L143.7014,74.734 L66.4214,74.734 L105.0614,193.655 L105.0614,193.655 Z" id="Fill-4" fill="#E24329"></path>
                    <path id="Fill-6" fill="#FC6D26"></path>
                    <path d="M105.0614,193.6548 L66.4214,74.7338 L12.2684,74.7338 L105.0614,193.6548 Z" id="Fill-8" fill="#FC6D26"></path>
                    <path id="Fill-10" fill="#FC6D26"></path>
                    <path d="M12.2685,74.7341 L12.2685,74.7341 L0.5265,110.8731 C-0.5445,114.1691 0.6285,117.7801 3.4325,119.8171 L105.0615,193.6551 L12.2685,74.7341 Z" id="Fill-12" fill="#FCA326"></path>
                    <path id="Fill-14" fill="#FC6D26"></path>
                    <path d="M12.2685,74.7342 L66.4215,74.7342 L43.1485,3.1092 C41.9515,-0.5768 36.7375,-0.5758 35.5405,3.1092 L12.2685,74.7342 Z" id="Fill-16" fill="#E24329"></path>
                    <path d="M105.0614,193.6548 L143.7014,74.7338 L197.8544,74.7338 L105.0614,193.6548 Z" id="Fill-18" fill="#FC6D26"></path>
                    <path d="M197.8544,74.7341 L197.8544,74.7341 L209.5964,110.8731 C210.6674,114.1691 209.4944,117.7801 206.6904,119.8171 L105.0614,193.6551 L197.8544,74.7341 Z" id="Fill-20" fill="#FCA326"></path>
                    <path d="M197.8544,74.7342 L143.7014,74.7342 L166.9744,3.1092 C168.1714,-0.5768 173.3854,-0.5758 174.5824,3.1092 L197.8544,74.7342 Z" id="Fill-22" fill="#E24329"></path>
                </g>
            </g>
        </g>
    </g>
</svg>
    </span>
    <span class="username">
        briancaffey
    </span>
</a>
          </li>
          
          
          <li>
            <a href="https://twitter.com/briancaffey"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#00aced" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">briancaffey</span></a>

          </li>
          
          
          <li>
                <a href="https://www.linkedin.com/in/brian-caffey-06b22a18">
      <span class="icon  icon--linkedin">
        <svg viewBox="0 50 512 512" >
          <path fill="#828282" d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
          C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
          M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
          c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
          s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"/>
        </svg>
      </span>
  
      <span class="username">Brian Caffey</span>
    </a>
          </li>
          
          
          <li>
            <a href="https://stackoverflow.com/users/6084948/briancaffey">
    <span class="so-icon icon--github">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 120 120" style="enable-background:new 0 0 120 120;" xml:space="preserve">
<style type="text/css">
	.st0{fill:#BCBBBB;}
	.st1{fill:#F48023;}
</style>
<polygon class="st0" points="84.4,93.8 84.4,70.6 92.1,70.6 92.1,101.5 22.6,101.5 22.6,70.6 30.3,70.6 30.3,93.8 "/>
<path class="st1" d="M38.8,68.4l37.8,7.9l1.6-7.6l-37.8-7.9L38.8,68.4z M43.8,50.4l35,16.3l3.2-7l-35-16.4L43.8,50.4z M53.5,33.2
	l29.7,24.7l4.9-5.9L58.4,27.3L53.5,33.2z M72.7,14.9l-6.2,4.6l23,31l6.2-4.6L72.7,14.9z M38,86h38.6v-7.7H38V86z"/>
</svg>

    </span>
    <span class="username">
        briancaffey
    </span>
</a>
          </li>
          
        </ul>
      </div>
      
      <div class="footer-col footer-col-3">
        <p>my personal site</p>
      </div>
      
    </div>

  </div>

</footer>


  </body>

</html>
